import F from'react';import {createStore}from'zustand/vanilla';import {subscribeWithSelector}from'zustand/middleware';import {jsxs}from'react/jsx-runtime';var M=(t=>typeof require!="undefined"?require:typeof Proxy!="undefined"?new Proxy(t,{get:(a,s)=>(typeof require!="undefined"?require:a)[s]}):t)(function(t){if(typeof require!="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var O=new Set(["__proto__","prototype","constructor"]);function C(t){if(O.has(t))throw new Error(`Unsafe key: ${t}`)}function w(t){if(Array.isArray(t))return t.slice();let a=String(t),s=a.length;if(s===0)return [];let e=[],r=0;for(;r<s;){let l=r;for(;r<s;){let f=a.charCodeAt(r);if(f===46||f===91)break;r++;}if(r>l){let f=a.slice(l,r);C(f),e.push(f);}if(r>=s)break;let d=a.charCodeAt(r);if(d===46){r++;continue}if(d===91){r++;let f=false,g=0;for(;r<s;){let m=a.charCodeAt(r);if(m===93)break;if(m<48||m>57)throw new Error(`Invalid index: ${a[r]}`);f=true,g=g*10+(m-48),r++;}if(r>=s||a.charCodeAt(r)!==93)throw new Error("Unclosed bracket");if(r++,!f)throw new Error("Invalid index: ");e.push(g),r<s&&a.charCodeAt(r)===46&&r++;}}return e}function b(t,a){let s=w(a),e=t;for(let r=0;r<s.length;r++){if(e==null)return;e=e[s[r]];}return e}function P(t,a,s){let e=w(a),r=e.length;if(r===0)return s;let l=t;for(let i=0;i<r-1&&l!=null;i++)l=l[e[i]];let d=e[r-1];if((l!=null?l[d]:void 0)===s)return t;let m=Array.isArray(t)?t?t.slice():[]:t?{...t}:{},o=m;for(let i=0;i<r;i++){let y=e[i],u=i===r-1;if(typeof y=="string"&&C(y),u){o[y]=s;break}let c=o[y],h=e[i+1],n,S=typeof h=="number";Array.isArray(c)?n=c.slice():S?n=[]:n=c?{...c}:{},o[y]=n,o=n;}return m}function _(t,a,s){let e={name:t,__initial:a,formState:{dirtyFields:{},touchedFields:{},errors:{}},resolverEpoch:0},l=createStore((d=>{if(process.env.NODE_ENV!=="production"&&s){let{devtools:f}=M("zustand/middleware");return f(subscribeWithSelector(d),{name:t})}return subscribeWithSelector(d)})(()=>e));return {getState:l.getState,setState:(d,f,g)=>{let m=d(l.getState()),o=l.setState;typeof o=="function"&&o.length>=3&&g!==void 0?o(m,true,g):typeof o=="function"&&o(m,true);},subscribe:d=>l.subscribe(d)}}var L=F.createContext(null);function H(t){let a=t.name||"rzf",s=F.useRef();s.current||(s.current=_(a,t.defaultValues,!!t.devtools));let e=s.current,[r,l]=F.useState(e.getState().formState);F.useEffect(()=>{let o=e.subscribe(i=>l(i.formState));return ()=>o()},[e]);let d=F.useCallback(async o=>{var y,u;if(!t.resolver)return;let i=++e.getState().resolverEpoch;try{let c=await t.resolver(o);if(i!==e.getState().resolverEpoch)return;let h=(y=c==null?void 0:c.errors)!=null?y:{};e.setState(n=>({...n,formState:{...n.formState,errors:h}}),!1,{type:`${a} resolver:ok`});}catch(c){if(i!==e.getState().resolverEpoch)return;let h={_root:String((u=c==null?void 0:c.message)!=null?u:c)};e.setState(n=>({...n,formState:{...n.formState,errors:h}}),false,{type:`${a} resolver:err`});}},[a,t.resolver,e]),f=F.useCallback(({children:o})=>jsxs(L.Provider,{value:e,children:[" ",o," "]}),[e]);function g(o,i={}){var c,h;let y=w(o),u=b(t.defaultValues,y);return i.uncontrolled?{name:o,defaultValue:u,ref:n=>{var p;if(!n)return;let S=e.getState(),T=(p=S.__domRefs)!=null?p:S.__domRefs={};T[o]={current:n};},onChange:n=>{let S=n.currentTarget.value,T=String(S)!==String(u!=null?u:"");e.setState(p=>({...p,formState:{...p.formState,dirtyFields:{...p.formState.dirtyFields,[o]:T}}}),false,{type:`${a} field:dirty`});},onBlur:()=>{e.setState(n=>({...n,formState:{...n.formState,touchedFields:{...n.formState.touchedFields,[o]:true}}}),false,{type:`${a} field:touched`});}}:{name:o,value:(h=b((c=e.getState().value)!=null?c:t.defaultValues,y))!=null?h:"",onChange:n=>{let S=n.currentTarget.value,T;e.setState(v=>{var E;let A=(E=v.value)!=null?E:t.defaultValues,k=P(A,y,S);T=k;let x={...v.formState.dirtyFields,[o]:String(S)!==String(u!=null?u:"")};return {...v,value:k,formState:{...v.formState,dirtyFields:x}}},false,{type:`${a} field:set`}),(v=>typeof queueMicrotask=="function"?queueMicrotask(v):Promise.resolve().then(v))(()=>d(T));},onBlur:()=>{e.setState(n=>({...n,formState:{...n.formState,touchedFields:{...n.formState.touchedFields,[o]:true}}}),false,{type:`${a} field:touched`});}}}return {Provider:f,register:g,handleSubmit:o=>i=>{var h,n;(h=i==null?void 0:i.preventDefault)==null||h.call(i);let u=(n=e.getState().__domRefs)!=null?n:{},c=JSON.parse(JSON.stringify(t.defaultValues));Object.keys(u).forEach(S=>{var x;let T=(x=u[S])==null?void 0:x.current;if(!T)return;let p=w(S);b(c,p);let A=T.value,k=P(c,p,A);Object.assign(c,k);}),o(c);},formState:r,store:e}}function J(){let t=F.useContext(L);if(!t)throw new Error("useFormStore must be used under Provider");return t}export{H as useForm,J as useFormStore};//# sourceMappingURL=useForm.mjs.map
//# sourceMappingURL=useForm.mjs.map